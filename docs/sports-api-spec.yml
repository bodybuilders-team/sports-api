openapi: 3.0.1
info:
  title: Sports API
  description: 'API for an application that manages sports'
  termsOfService: https://swagger.io/terms/
  version: 1.0.0

servers:
  - url: http://localhost:8888/api

tags:
  - name: Users

  - name: Routes

  - name: Sports

  - name: Activities

paths:

  /users:
    post:
      tags:
        - Users
      summary: Creates a new user
      requestBody:
        description: User object
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUserRequest'

      responses:
        201:
          description: User was created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateUserResponse'
        400:
          description: Invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppError'
        409:
          description: User with the same email already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppError'
        500:
          $ref: '#/components/responses/InternalServerErrorResponse'

    get:
      tags:
        - Users
      summary: Gets all users
      parameters:
        - name: skip
          in: query
          description: Number of entities to skip
          required: false
          schema:
            type: integer
            default: 0

        - name: limit
          in: query
          description: Number of entities that are returned
          required: false
          schema:
            type: integer
            default: 10
      responses:
        200:
          description: Users were found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UsersResponse'
        500:
          $ref: '#/components/responses/InternalServerErrorResponse'

  /users/{id}:
    get:
      tags:
        - Users
      summary: Gets a user by id
      parameters:
        - name: id
          in: path
          description: User id
          required: true
          schema:
            type: integer
            default: 1
      responses:
        200:
          description: User was found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        400:
          description: Invalid user id
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppError'
        404:
          description: User was not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppError'
        500:
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppError'

  /users/{id}/activities:
    get:
      tags:
        - Users
      summary: Gets all activities made by a user
      parameters:
        - name: id
          in: path
          description: User id
          required: true
          schema:
            type: integer
            default: 1
        - name: skip
          in: query
          description: Number of entities to skip
          required: false
          schema:
            type: integer
            default: 0

        - name: limit
          in: query
          description: Number of entities that are returned
          required: false
          schema:
            type: integer
            default: 10

      responses:
        200:
          description: Activities were found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ActivitiesResponse'
        400:
          description: Invalid user id
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppError'
        500:
          $ref: '#/components/responses/InternalServerErrorResponse'

  /routes:
    post:
      tags:
        - Routes
      summary: Creates a new route
      security:
        - token: [ ]
      requestBody:
        description: Route object
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateRouteRequest'
      responses:
        201:
          description: Route was created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateRouteResponse'
        400:
          description: Invalid Request Body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppError'
        500:
          $ref: '#/components/responses/InternalServerErrorResponse'
    get:
      tags:
        - Routes
      parameters:
        - name: skip
          in: query
          description: Number of entities to skip
          required: false
          schema:
            type: integer
            default: 0

        - name: limit
          in: query
          description: Number of entities that are returned
          required: false
          schema:
            type: integer
            default: 10
      summary: Gets all routes
      responses:
        200:
          description: Routes were found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoutesResponse'
        500:
          $ref: '#/components/responses/InternalServerErrorResponse'


  /routes/{id}:
    get:
      tags:
        - Routes
      summary: Gets a route by id
      parameters:
        - name: id
          in: path
          description: Route id
          required: true
          schema:
            type: integer
            default: 1
      responses:

        200:
          description: Route was found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Route'

        400:
          description: Invalid route id
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppError'

        404:
          description: Route was not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppError'
        500:
          $ref: '#/components/responses/InternalServerErrorResponse'

  /sports:
    post:
      tags:
        - Sports
      summary: Creates a new sport
      security:
        - token: [ ]
      requestBody:

        description: Sport object
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateSportRequest'
      responses:
        201:
          description: Sport was created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateSportResponse'

        400:
          $ref: '#/components/responses/InvalidRequestBodyResponse'

        500:
          $ref: '#/components/responses/InternalServerErrorResponse'

    get:
      tags:
        - Sports
      summary: Gets all sports
      parameters:
        - name: skip
          in: query
          description: Number of entities to skip
          required: false
          schema:
            type: integer
            default: 0

        - name: limit
          in: query
          description: Number of entities that are returned
          required: false
          schema:
            type: integer
            default: 10
      responses:
        200:
          description: Sports were found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SportsResponse'
        500:
          $ref: '#/components/responses/InternalServerErrorResponse'

  /sports/{id}:
    get:
      tags:
        - Sports
      summary: Gets a sport by id
      parameters:
        - name: id
          in: path
          description: Sport id
          required: true
          schema:
            type: integer
            default: 1
      responses:
        200:
          description: Sport was found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Sport'
        400:
          description: Invalid sport id
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppError'
        404:
          description: Sport was not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppError'
        500:
          $ref: '#/components/responses/InternalServerErrorResponse'

  /sports/{id}/activities:
    get:
      tags:
        - Sports
      summary: Gets all activities of a sport
      parameters:
        - name: id
          in: path
          description: Sport id
          required: true
          schema:
            type: integer
            default: 1
        - name: skip
          in: query
          description: Number of entities to skip
          required: false
          schema:
            type: integer
            default: 0

        - name: limit
          in: query
          description: Number of entities that are returned
          required: false
          schema:
            type: integer
            default: 10
      responses:
        200:
          description: Activity was found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ActivitiesResponse'
        400:
          description: Invalid sport id
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppError'

        404:
          description: Activity was not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppError'
        500:
          $ref: '#/components/responses/InternalServerErrorResponse'


  /activities:
    post:
      tags:
        - Activities
      summary: Creates a new activity for the sport identified by a sport id
      security:
        - token: [ ]
      requestBody:
        description: Activity object
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateActivityRequest'
      responses:
        201:
          description: Activity was created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateActivityResponse'

        400:
          $ref: '#/components/responses/InvalidRequestBodyResponse'

        500:
          $ref: '#/components/responses/InternalServerErrorResponse'
    delete:
      tags:
        - Activities
      summary: Deletes activities
      security:
        - token: [ ]
      requestBody:
        description: Activities to delete
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ActivitiesDeleteRequest'
      responses:
        200:
          description: Activities deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        400:
          description: Invalid activity ids
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppError'
        500:
          $ref: '#/components/responses/InternalServerErrorResponse'

    get:
      tags:
        - Activities
      summary: Searches for activities
      parameters:
        - name: sid
          in: query
          description: Sport Id
          required: true
          schema:
            type: integer
            default: 1

        - name: orderBy
          in: query
          description: Order by
          required: true
          schema:
            type: string

        - name: date
          in: query
          description: Activity date
          required: false
          schema:
            type: string

        - name: rid
          in: query
          description: Route id
          required: false
          schema:
            type: integer
            default: 1

        - name: skip
          in: query
          description: Number of entities to skip
          required: false
          schema:
            type: integer
            default: 0

        - name: limit
          in: query
          description: Number of entities that are returned
          required: false
          schema:
            type: integer
            default: 10

      responses:
        200:
          description: Activity was found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ActivitiesResponse'
        400:
          description: Invalid query params
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppError'
        404:
          description: Activity was not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppError'
        500:
          $ref: '#/components/responses/InternalServerErrorResponse'

  /activities/users:
    get:
      tags:
        - Activities
      summary: Searches for all users that have an activity with a specified sport id and route id
      parameters:
        - name: sid
          in: query
          description: Sport Id
          required: true
          schema:
            type: integer
            default: 1

        - name: rid
          in: query
          description: Route id
          required: true
          schema:
            type: integer
            default: 1

        - name: skip
          in: query
          description: Number of entities to skip
          required: false
          schema:
            type: integer
            default: 0

        - name: limit
          in: query
          description: Number of entities that are returned
          required: false
          schema:
            type: integer
            default: 10

      responses:
        200:
          description: Users were found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ActivityUsersResponse'
        400:
          description: Invalid query params
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppError'
        500:
          $ref: '#/components/responses/InternalServerErrorResponse'

  /activities/{id}:
    get:
      tags:
        - Activities
      summary: Gets an activity by id
      parameters:
        - name: id
          in: path
          description: Activity id
          required: true
          schema:
            type: integer
            default: 1
      responses:
        200:
          description: Activity was found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Activity'
        400:
          description: Invalid activity id
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppError'
        404:
          description: Activity was not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppError'
        500:
          $ref: '#/components/responses/InternalServerErrorResponse'

    delete:
      tags:
        - Activities
      summary: Deletes an activity by id
      security:
        - token: [ ]
      parameters:
        - name: id
          in: path
          description: Activity id
          required: true
          schema:
            type: integer
      responses:
        200:
          description: Activity deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        400:
          description: Invalid activity id
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppError'
        404:
          description: Activity was not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppError'
        500:
          $ref: '#/components/responses/InternalServerErrorResponse'


components:
  responses:
    InternalServerErrorResponse:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/AppError'

    InvalidRequestBodyResponse:
      description: Invalid request body
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/AppError'

  schemas:
    UsersResponse:
      type: object
      required:
        - users
      properties:
        users:
          type: array
          items:
            $ref: '#/components/schemas/User'

    RoutesResponse:
      type: object
      required:
        - routes
      properties:
        routes:
          type: array
          items:
            $ref: '#/components/schemas/Route'

    SportsResponse:
      type: object
      required:
        - sports
      properties:
        sports:
          type: array
          items:
            $ref: '#/components/schemas/Sport'

    ActivitiesResponse:
      type: object
      required:
        - activities
      properties:
        activities:
          type: array
          items:
            $ref: '#/components/schemas/Activity'

    CreateUserResponse:
      type: object
      required:
        - uid
        - token
      properties:
        uid:
          type: integer
          default: 1
          description: User Id
        token:
          type: string
          description: User Token

    ActivityUsersResponse:
      type: object
      required:
        - activityUsers
      properties:
        activities:
          type: array
          items:
            $ref: '#/components/schemas/ActivityUser'

    ActivitiesDeleteRequest:
      type: object
      required:
        - activityIds
      properties:
        activityIds:
          type: array
          items:
            type: integer
            description: Activity Id

    CreateRouteResponse:
      type: object
      required:
        - rid
      properties:
        rid:
          type: integer
          default: 1
          description: Route Id

    CreateSportResponse:
      type: object
      required:
        - sid
      properties:
        sid:
          type: integer
          default: 1
          description: Sport Id

    CreateActivityResponse:
      type: object
      required:
        - aid
      properties:
        aid:
          type: integer
          default: 1
          description: Activity Id

    MessageResponse:
      type: object
      required:
        - id
      properties:
        message:
          type: integer
          description: Message

    AppError:
      type: object
      description: Application error
      required:
        - name
        - description
      properties:
        name:
          type: string
          description: Internal error name
          example: FAIL
        description:
          type: string
          description: Error description message
          example: An error occurred
        extraInfo:
          type: string
          description: Extra error info
          example: "{message:\"User not found\"}"

    CreateRouteRequest:
      type: object
      required:
        - startLocation
        - endLocation
        - distance
      properties:
        startLocation:
          type: string
          description: Route start location

        endLocation:
          type: string
          description: Route end location

        distance:
          type: number
          description: Route distance in km
          example: 15.2

    CreateActivityRequest:
      required:
        - date
        - duration
        - sid
      properties:
        date:
          $ref: '#/components/schemas/Date'

        duration:
          $ref: '#/components/schemas/Duration'

        sid:
          type: integer
          default: 1
          description: Sport id

        rid:
          type: integer
          default: 1
          description: Route id

    CreateUserRequest:
      type: object
      required:
        - name
        - email
      properties:
        name:
          type: string
          description: User name
          example: André Páscoa
        email:
          type: string
          description: User email
          example: andre@pascoa.org

    CreateSportRequest:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          description: Sport name
          example: Powerlifting

        description:
          type: string
          description: Sport Description
          example: andre@pascoa.org

    ActivityUser:
      type: object
      description: Activity User object
      required:
        - id
        - activityId
        - name
        - email
      properties:
        id:
          type: integer
          description: User Id
        activityId:
          type: integer
          description: Activity Id
        name:
          type: string
          description: User name
          example: André Páscoa
        email:
          type: string
          description: User email
          example: andre@pascoa.org

    User:
      type: object
      description: User object
      required:
        - id
        - name
        - email
      properties:
        id:
          type: integer
          description: User Id
        name:
          type: string
          description: User name
          example: André Páscoa
        email:
          type: string
          description: User email
          example: andre@pascoa.org

    Sport:
      type: object
      description: Sport object
      required:
        - id
        - name
        - uid
      properties:
        id:
          type: integer
          default: 1
          description: Sport id
        name:
          type: string
          description: Sport name
          example: Powerlifting

        description:
          type: string
          description: Sport Description

        uid:
          type: integer
          default: 1
          description: User id

    Route:
      type: object
      description: Route object
      required:
        - id
        - startLocation
        - endLocation
        - distance
        - uid
      properties:
        id:
          type: integer
          description: Route id

        startLocation:
          type: string
          description: Route start location
          example: "Porto, Portugal"

        endLocation:
          type: string
          description: Route end location
          example: "Lisbon, Portugal"

        distance:
          type: number
          description: Route distance in km
          example: 15.2

        uid:
          type: integer
          default: 1
          description: User id

    Activity:
      type: object
      description: Activity object
      required:
        - id
        - date
        - duration
        - uid
        - sid
      properties:
        id:
          type: integer
          description: Activity id

        date:
          $ref: '#/components/schemas/Date'

        duration:
          $ref: '#/components/schemas/Duration'

        uid:
          type: integer
          default: 1
          description: User id

        sid:
          type: integer
          default: 1
          description: Sport id

        rid:
          type: integer
          default: 1
          description: Route id

    Duration:
      type: string
      description: Duration (HH:MM:SS.FFF)
      pattern: ^(?:[01]\d|2[0123])\:(?:[012345]\d)\:(?:[012345]\d)\.\d{3}$
      example: "01:23:45.678"

    Date:
      type: string
      description: Date (YYYY-MM-DD)
      pattern: ^\d{4}\-(0[1-9]|1[012])\-(0[1-9]|[12][0-9]|3[01])$
      example: "2001-09-26"

  securitySchemes:
    token:
      type: http
      scheme: bearer
